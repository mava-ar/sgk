{% extends "frontend/ficha_kinesica.html" %}
{% load bootstrap3 static frontend_tags %}
{% block extra_head %}
{{ objetivo_formset.media }}
{% endblock %}
{% block subtitle %}
    Ficha Kinésica - Motivo de consulta
{% endblock %}
{% block content_ficha %}
    <h2>{% if object.pk %}Editar {% else %}Nuevo {% endif %}motivo de consulta de {{ paciente }}</h2>
    <form action="" method="post" novalidate="">
    {% csrf_token %}
    {% bootstrap_form form %}
    <div class="panel panel-success">
        <div class="panel-heading">Objetivos</div>
        <div class="panel-body">
            <div id="more_objetivo">
                {{ objetivo_formset.management_form }}
                {% for form_inline in objetivo_formset %}
                    <div class="inline_formset panel panel-success {% if form_inline.instance.pk %}is_origin{% endif %}">
                        <div class="panel-body">
                            {% bootstrap_field form_inline.descripcion %}
                            <div class="row">
                                <div class="col-md-6">
                                {% bootstrap_field form_inline.fecha_inicio %}
                                </div>
                                <div class="col-md-6">
                                {% bootstrap_field form_inline.fecha_cumplido %}
                                </div>
                            </div>
                            {% bootstrap_field form_inline.observaciones %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <div id="empty_form" style="display:none">
        <div class="inline_formset panel panel-success">
            <div class="panel-body">
                {% bootstrap_field objetivo_formset.empty_form.descripcion %}
                <div class="row">
                    <div class="col-md-6">
                    {% bootstrap_field objetivo_formset.empty_form.fecha_inicio %}
                    </div>
                    <div class="col-md-6">
                    {% bootstrap_field objetivo_formset.empty_form.fecha_cumplido %}
                    </div>
                </div>
                {% bootstrap_field objetivo_formset.empty_form.observaciones %}
            </div>
        </div>
    </div>
{#    {% bootstrap_formset objetivo_formset %}#}
    {% buttons %}
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a href="{% url 'ficha_kinesica' paciente.pk %}">
            <input type="button" class="btn " value="Volver" />
        </a>
    {% endbuttons %}
    </form>
{% endblock %}
{% block extra_js %}
    <script type="text/javascript" src="{% static 'django-dynamic-formset/src/jquery.formset.js' %}" ></script>
    <script type="text/javascript">
        (function($){
            $(document).ready(function(){
                $({% if objetivo_formset.forms %}'#more_objetivo div.inline_formset'{% else %}'#empty_form div.inline_formset'{% endif %}).formset({
                    deleteText: '<i class="fa fa-remove"></i>',
                    addText: 'Añadir un nuevo objetivo',
                    prefix: '{{ objetivo_formset.prefix }}',
                    //formTemplate: '#empty_form',
                    deleteCssClass: "btn btn-danger",
                    addCssClass: "btn btn-success"

                });
            });
        })(jQuery);

    </script>

{% endblock %}
