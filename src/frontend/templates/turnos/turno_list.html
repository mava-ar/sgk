{% extends "base_site.html" %}
{% load bootstrap3 pipeline %}
{% block extra_head %}
    {% stylesheet 'fullcalendar' %}
    {% javascript 'fullcalendar_js' %}
{% endblock %}
{% block subtitle %}
    Inicio
{% endblock %}
{% block content %}
    <h2>Listado de turnos
{% buttons %}
<a href="{% url 'turno_create' %}" />
<button type="button" class="btn btn-primary pull-right">
  {% bootstrap_icon "plus" %} Nuevo turno
</button>
</a>
{% endbuttons %}
    </h2>
    <table class="table table-condensed table-striped">
        <thead>
            <tr>
                <th>Día</th>
                <th>Hora</th>
                <th>Paciente</th>
                <th>Profesional</th>
                <th>Duración</th>
                <th>Motivo</th>
{#                <th>Asistió</th>#}
{#                <th>Avisó</th>#}
{#                <th>Observaciones</th>#}
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for t in object_list %}
                <tr>
                    <td><a href="{% url 'turno_update' t.pk %}">{{ t.dia|date:"d F, Y" }}</a></td>
                    <td><a href="{% url 'turno_update' t.pk %}">{{ t.hora|date:"H:i" }}</a></td>
                    <td>{% if not t.paciente %}
                            {{ t.nombre_paciente }}
                        {% else %}
                            {{ t.paciente }}
                        {% endif %}
                    </td>
                    <td>{{ t.profesional }}</td>
                    <td>{{ t.duracion }}</td>
                    <td>{{ t.motivo }}</td>
{#                    <td>{{ t.asistio|yesno:"Yes,No" }}</td>#}
{#                    <td>{{ t.aviso|yesno:"Yes,No"  }}</td>#}
{#                    <td>{{ t.observaciones }}</td>#}
                    <td>
                        {% if t.paciente %}
                            {% if t.paciente.tratamiento_activo %}
                                <a class="btn btn-danger"
                                   href="{% url 'sesion_create' t.paciente.pk t.paciente.tratamiento_activo.pk %}?turno={{ t.pk }}">
                                    <i class="fa fa-plus"></i> Sesión</a>
                            {% endif %}
                            <a class="btn btn-default" href="{% url 'ficha_kinesica' t.paciente.pk %}">
                                <i class="fa fa-list"></i> Ficha
                            </a>
                            {% else %}
                                <a class="btn btn-primary" href="{% url 'paciente_create' %}">
                                    <i class="fa fa-plus"></i> Paciente
                                </a>

                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div id='calendar'></div>
{% endblock %}

{% block js %}
    <script type="text/javascript">
        (function($){
            $(document).ready(function(){
                $('#calendar').fullCalendar({
                    header: {
                        left:   'title',
                        center: 'month agendaWeek, agendaDay',
                        right:  'today prev,next'
                    },

                    defaultView: 'agendaWeek',
                    allDaySlot: false,
                    minTime: '08:00:00',
                    maxTime: '22:00:00',
                    businessHours: {
                        start: '08:00',
                        end: '22:00',
                        dow: [ 1, 2, 3, 4, 5, 6, 7 ]
                    },
                    aspectRatio: 1.7,
                    lang: 'es',
                    events: [
                        {
                            title  : 'event1',
                            start  : '2016-05-27'
                        },
                        {
                            title  : 'event2',
                            start  : '2016-05-26T08:00:00',
                            end    : '2010-05-26T09:00:00',
                            editable: true
                        },

                    ]
                });
            });
        })(jQuery);
    </script>
{% endblock %}
